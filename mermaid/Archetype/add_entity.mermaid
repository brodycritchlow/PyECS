flowchart TD
    Start([add_entity called with entity and components list]) --> CheckExists{Entity in entity_indices dict?}
    
    CheckExists -->|Yes| ReturnFailure[Return FAILURE]
    CheckExists -->|No| CalcIndex["Calculate entity_index as len(entities)"]
    
    CalcIndex --> AppendEntity[Append entity to entities list]
    AppendEntity --> AddToDict["Add entity->entity_index to entity_indices dict"]
    AddToDict --> LoopComponents[Loop through components]
    
    LoopComponents --> GetCompType[Get component.__class__]
    GetCompType --> CheckTypeExists{Component type in self.components?}
    
    CheckTypeExists -->|No| CreateList[Create list with None * entity_index]
    CheckTypeExists -->|Yes| AppendToList[Append component to type list]
    
    CreateList --> AddToDict[Add list to components dict]
    AddToDict --> AppendToList
    
    AppendToList --> MoreComponents{More components?}
    
    MoreComponents -->|Yes| LoopComponents
    MoreComponents -->|No| ReturnSuccess[Return SUCCESS]
    
    ReturnFailure --> End1([End])
    ReturnSuccess --> End2([End])